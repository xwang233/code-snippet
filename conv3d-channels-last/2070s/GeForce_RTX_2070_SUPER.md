
## profiling

device is GeForce RTX 2070 SUPER

cudnn_ver is 8005

time is in ms

backward is dgrad + wgrad

shape is (n, c, dhw, oc, ks, pad, stride)

E.g. (2, 4, 128, 32, 3, 1, 1) means

```python
x = torch.randn(2, 4, 128, 128, 128, dtype=torch.half, device='cuda').requires_grad_()
x = x.to(memory_format=torch.channels_last_3d)
net = torch.nn.Conv3d(4, 32, kernel_size=3, padding=1, stride=1)
net = net.to(dtype=torch.half, device='cuda', memory_format=torch.channels_last_3d)
net(x)
```

### channels-last-3d-forward

| shape | master | PR | speed improvement |
| --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 1.218 | 1.011 | 1.20|
| (2, 128, 32, 128, 3, 1, 1)| 2.732 | 1.934 | 1.41|
| (2, 128, 32, 256, 2, 0, 2)| 0.935 | 0.229 | 4.08|
| (2, 128, 32, 256, 3, 1, 2)| 1.199 | 0.517 | 2.32|
| (2, 128, 64, 64, 3, 1, 1)| 21.997 | 7.740 | 2.84|
| (2, 256, 16, 256, 3, 1, 1)| 1.189 | 1.016 | 1.17|
| (2, 256, 16, 512, 2, 0, 2)| 0.298 | 0.235 | 1.27|
| (2, 256, 16, 512, 3, 1, 2)| 0.441 | 0.296 | 1.49|
| (2, 256, 32, 128, 3, 1, 1)| 5.477 | 3.620 | 1.51|
| (2, 32, 128, 32, 3, 1, 1)| 43.026 | 15.456 | 2.78|
| (2, 32, 128, 4, 1, 0, 1)| 27.523 | 2.331 | 11.81|
| (2, 32, 128, 64, 2, 0, 2)| 28.158 | 1.571 | 17.92|
| (2, 32, 128, 64, 3, 1, 2)| 29.052 | 2.534 | 11.46|
| (2, 4, 128, 32, 3, 1, 1)| 11.207 | 11.212 | 1.00|
| (2, 512, 16, 256, 3, 1, 1)| 2.177 | 1.872 | 1.16|
| (2, 512, 4, 512, 3, 1, 1)| 0.286 | 0.243 | 1.18|
| (2, 512, 8, 512, 2, 0, 2)| 0.292 | 0.230 | 1.27|
| (2, 512, 8, 512, 3, 1, 1)| 0.676 | 0.560 | 1.21|
| (2, 512, 8, 512, 3, 1, 2)| 0.297 | 0.244 | 1.22|
| (2, 64, 128, 32, 3, 1, 1)| 193.790 | 22.123 | 8.76|
| (2, 64, 64, 128, 2, 0, 2)| 7.462 | 0.442 | 16.89|
| (2, 64, 64, 128, 3, 1, 2)| 8.125 | 1.099 | 7.39|
| (2, 64, 64, 64, 3, 1, 1)| 11.316 | 4.105 | 2.76|



### channels-last-3d-backward

| shape | master | PR | speed improvement |
| --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 2.638 | 2.183 | 1.21|
| (2, 128, 32, 128, 3, 1, 1)| 5.035 | 3.788 | 1.33|
| (2, 128, 32, 256, 2, 0, 2)| 1.122 | 0.693 | 1.62|
| (2, 128, 32, 256, 3, 1, 2)| 1.809 | 1.229 | 1.47|
| (2, 128, 64, 64, 3, 1, 1)| 28.675 | 17.270 | 1.66|
| (2, 256, 16, 256, 3, 1, 1)| 2.229 | 1.935 | 1.15|
| (2, 256, 16, 512, 2, 0, 2)| 0.880 | 0.697 | 1.26|
| (2, 256, 16, 512, 3, 1, 2)| 0.915 | 0.773 | 1.18|
| (2, 256, 32, 128, 3, 1, 1)| 9.358 | 7.572 | 1.24|
| (2, 32, 128, 32, 3, 1, 1)| 67.587 | 34.628 | 1.95|
| (2, 32, 128, 4, 1, 0, 1)| 11.338 | 6.104 | 1.86|
| (2, 32, 128, 64, 2, 0, 2)| 20.302 | 7.532 | 2.70|
| (2, 32, 128, 64, 3, 1, 2)| 23.490 | 10.644 | 2.21|
| (2, 4, 128, 32, 3, 1, 1)| 59.776 | 31.377 | 1.91|
| (2, 512, 16, 256, 3, 1, 1)| 4.238 | 3.747 | 1.13|
| (2, 512, 4, 512, 3, 1, 1)| 0.745 | 0.646 | 1.15|
| (2, 512, 8, 512, 2, 0, 2)| 0.846 | 0.656 | 1.29|
| (2, 512, 8, 512, 3, 1, 1)| 1.358 | 1.106 | 1.23|
| (2, 512, 8, 512, 3, 1, 2)| 0.934 | 0.727 | 1.28|
| (2, 64, 128, 32, 3, 1, 1)| 452.929 | 56.743 | 7.98|
| (2, 64, 64, 128, 2, 0, 2)| 4.402 | 1.937 | 2.27|
| (2, 64, 64, 128, 3, 1, 2)| 5.674 | 3.169 | 1.79|
| (2, 64, 64, 64, 3, 1, 1)| 17.696 | 8.787 | 2.01|



