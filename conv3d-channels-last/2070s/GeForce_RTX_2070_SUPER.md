
## profiling

device is GeForce RTX 2070 SUPER

cudnn_ver is 8005

time is in ms

backward is dgrad + wgrad

shape is (n, c, dhw, oc, ks, pad, stride)

E.g. (2, 4, 128, 32, 3, 1, 1) means

```python
x = torch.randn(2, 4, 128, 128, 128, dtype=torch.half, device='cuda').requires_grad_()
x = x.to(memory_format=torch.channels_last_3d)
net = torch.nn.Conv3d(4, 32, kernel_size=3, padding=1, stride=1)
net = net.to(dtype=torch.half, device='cuda', memory_format=torch.channels_last_3d)
net(x)
```

### channels-last-3d-forward

| shape | contiguous | master (ch-last) | PR (ch-last) | PR > master (ch-last)? | PR > contiguous? |
| --- | --- | --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 1.157 | 1.218 | 1.011 | 1.20x | 1.17x |
| (2, 128, 32, 128, 3, 1, 1)| 2.165 | 2.732 | 1.934 | 1.41x | 1.13x |
| (2, 128, 32, 256, 2, 0, 2)| 0.373 | 0.935 | 0.229 | 4.08x | 1.63x |
| (2, 128, 32, 256, 3, 1, 2)| 0.664 | 1.199 | 0.517 | 2.32x | 1.31x |
| (2, 128, 64, 64, 3, 1, 1)| 8.894 | 21.997 | 7.740 | 2.84x | 1.16x |
| (2, 256, 16, 256, 3, 1, 1)| 1.086 | 1.189 | 1.016 | 1.17x | 1.09x |
| (2, 256, 16, 512, 2, 0, 2)| 0.281 | 0.298 | 0.235 | 1.27x | 1.24x |
| (2, 256, 16, 512, 3, 1, 2)| 0.359 | 0.441 | 0.296 | 1.49x | 1.22x |
| (2, 256, 32, 128, 3, 1, 1)| 4.028 | 5.477 | 3.620 | 1.51x | 1.13x |
| (2, 32, 128, 32, 3, 1, 1)| 18.886 | 43.026 | 15.456 | 2.78x | 1.22x |
| (2, 32, 128, 4, 1, 0, 1)| 3.037 | 27.523 | 2.331 | 11.81x | 1.29x |
| (2, 32, 128, 64, 2, 0, 2)| 3.556 | 28.158 | 1.571 | 17.92x | 2.25x |
| (2, 32, 128, 64, 3, 1, 2)| 4.500 | 29.052 | 2.534 | 11.46x | 1.79x |
| (2, 4, 128, 32, 3, 1, 1)| 10.841 | 11.207 | 11.212 | 1.00x | 0.97x |
| (2, 512, 16, 256, 3, 1, 1)| 1.992 | 2.177 | 1.872 | 1.16x | 1.08x |
| (2, 512, 4, 512, 3, 1, 1)| 0.285 | 0.286 | 0.243 | 1.18x | 1.16x |
| (2, 512, 8, 512, 2, 0, 2)| 0.278 | 0.292 | 0.230 | 1.27x | 1.24x |
| (2, 512, 8, 512, 3, 1, 1)| 0.651 | 0.676 | 0.560 | 1.21x | 1.18x |
| (2, 512, 8, 512, 3, 1, 2)| 0.279 | 0.297 | 0.244 | 1.22x | 0.98x |
| (2, 64, 128, 32, 3, 1, 1)| 26.805 | 193.790 | 22.123 | 8.76x | 6.52x |
| (2, 64, 64, 128, 2, 0, 2)| 0.916 | 7.462 | 0.442 | 16.89x | 2.07x |
| (2, 64, 64, 128, 3, 1, 2)| 1.581 | 8.125 | 1.099 | 7.39x | 1.45x |
| (2, 64, 64, 64, 3, 1, 1)| 4.877 | 11.316 | 4.105 | 2.76x | 1.20x |



### channels-last-3d-backward

| shape | contiguous | master (ch-last) | PR (ch-last) | PR > master (ch-last)? | PR > contiguous? |
| --- | --- | --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 2.546 | 2.638 | 2.183 | 1.21x | 1.19x |
| (2, 128, 32, 128, 3, 1, 1)| 4.220 | 5.035 | 3.788 | 1.33x | 1.13x |
| (2, 128, 32, 256, 2, 0, 2)| 0.822 | 1.122 | 0.693 | 1.62x | 1.19x |
| (2, 128, 32, 256, 3, 1, 2)| 1.488 | 1.809 | 1.229 | 1.47x | 1.22x |
| (2, 128, 64, 64, 3, 1, 1)| 19.193 | 28.675 | 17.270 | 1.66x | 1.12x |
| (2, 256, 16, 256, 3, 1, 1)| 2.065 | 2.229 | 1.935 | 1.15x | 1.08x |
| (2, 256, 16, 512, 2, 0, 2)| 0.734 | 0.880 | 0.697 | 1.26x | 1.16x |
| (2, 256, 16, 512, 3, 1, 2)| 0.828 | 0.915 | 0.773 | 1.18x | 1.09x |
| (2, 256, 32, 128, 3, 1, 1)| 8.265 | 9.358 | 7.572 | 1.24x | 1.10x |
| (2, 32, 128, 32, 3, 1, 1)| 40.803 | 67.587 | 34.628 | 1.95x | 1.19x |
| (2, 32, 128, 4, 1, 0, 1)| 8.300 | 11.338 | 6.104 | 1.86x | 1.35x |
| (2, 32, 128, 64, 2, 0, 2)| 11.313 | 20.302 | 7.532 | 2.70x | 1.49x |
| (2, 32, 128, 64, 3, 1, 2)| 14.352 | 23.490 | 10.644 | 2.21x | 1.36x |
| (2, 4, 128, 32, 3, 1, 1)| 35.098 | 59.776 | 31.377 | 1.91x | 1.13x |
| (2, 512, 16, 256, 3, 1, 1)| 3.968 | 4.238 | 3.747 | 1.13x | 1.08x |
| (2, 512, 4, 512, 3, 1, 1)| 0.708 | 0.745 | 0.646 | 1.15x | 1.09x |
| (2, 512, 8, 512, 2, 0, 2)| 0.714 | 0.846 | 0.656 | 1.29x | 1.21x |
| (2, 512, 8, 512, 3, 1, 1)| 1.300 | 1.358 | 1.106 | 1.23x | 1.19x |
| (2, 512, 8, 512, 3, 1, 2)| 0.911 | 0.934 | 0.727 | 1.28x | 1.25x |
| (2, 64, 128, 32, 3, 1, 1)| 65.648 | 452.929 | 56.743 | 7.98x | 7.39x |
| (2, 64, 64, 128, 2, 0, 2)| 2.877 | 4.402 | 1.937 | 2.27x | 1.50x |
| (2, 64, 64, 128, 3, 1, 2)| 4.110 | 5.674 | 3.169 | 1.79x | 1.32x |
| (2, 64, 64, 64, 3, 1, 1)| 10.297 | 17.696 | 8.787 | 2.01x | 1.19x |



