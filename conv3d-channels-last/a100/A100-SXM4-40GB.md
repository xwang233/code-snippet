
## profiling

device is A100-SXM4-40GB

cudnn_ver is 8005

time is in ms

backward is dgrad + wgrad

shape is (n, c, dhw, oc, ks, pad, stride)

E.g. (2, 4, 128, 32, 3, 1, 1) means

```python
x = torch.randn(2, 4, 128, 128, 128, dtype=torch.half, device='cuda').requires_grad_()
x = x.to(memory_format=torch.channels_last_3d)
net = torch.nn.Conv3d(4, 32, kernel_size=3, padding=1, stride=1)
net = net.to(dtype=torch.half, device='cuda', memory_format=torch.channels_last_3d)
net(x)
```

### channels-last-3d-forward

| shape | contiguous | master (ch-last) | PR (ch-last) | PR > master (ch-last)? | PR > contiguous? |
| --- | --- | --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 0.216 | 0.235 | 0.155 | 1.51x | 1.40x |
| (2, 128, 32, 128, 3, 1, 1)| 0.360 | 0.456 | 0.290 | 1.57x | 1.24x |
| (2, 128, 32, 256, 2, 0, 2)| 0.100 | 0.191 | 0.073 | 2.63x | 1.35x |
| (2, 128, 32, 256, 3, 1, 2)| 0.152 | 0.241 | 0.102 | 2.36x | 1.49x |
| (2, 128, 64, 64, 3, 1, 1)| 1.583 | 3.157 | 1.225 | 2.58x | 1.29x |
| (2, 256, 16, 256, 3, 1, 1)| 0.183 | 0.210 | 0.156 | 1.34x | 1.18x |
| (2, 256, 16, 512, 2, 0, 2)| 0.090 | 0.105 | 0.071 | 1.47x | 1.26x |
| (2, 256, 16, 512, 3, 1, 2)| 0.096 | 0.121 | 0.080 | 1.52x | 1.21x |
| (2, 256, 32, 128, 3, 1, 1)| 0.623 | 0.813 | 0.530 | 1.53x | 1.17x |
| (2, 32, 128, 32, 3, 1, 1)| 3.858 | 10.067 | 2.812 | 3.58x | 1.37x |
| (2, 32, 128, 4, 1, 0, 1)| 1.243 | 7.555 | 0.678 | 11.15x | 1.84x |
| (2, 32, 128, 64, 2, 0, 2)| 1.082 | 7.380 | 0.428 | 17.23x | 2.52x |
| (2, 32, 128, 64, 3, 1, 2)| 1.195 | 7.467 | 0.532 | 14.02x | 2.19x |
| (2, 4, 128, 32, 3, 1, 1)| 3.639 | 3.739 | 2.910 | 1.28x | 1.25x |
| (2, 512, 16, 256, 3, 1, 1)| 0.309 | 0.363 | 0.272 | 1.33x | 1.14x |
| (2, 512, 4, 512, 3, 1, 1)| 0.112 | 0.122 | 0.080 | 1.53x | 1.42x |
| (2, 512, 8, 512, 2, 0, 2)| 0.090 | 0.106 | 0.077 | 1.38x | 1.17x |
| (2, 512, 8, 512, 3, 1, 1)| 0.147 | 0.170 | 0.110 | 1.54x | 1.36x |
| (2, 512, 8, 512, 3, 1, 2)| 0.114 | 0.129 | 0.079 | 1.64x | 1.44x |
| (2, 64, 128, 32, 3, 1, 1)| 6.033 | 18.964 | 4.597 | 4.13x | 1.31x |
| (2, 64, 64, 128, 2, 0, 2)| 0.289 | 1.064 | 0.132 | 8.08x | 2.19x |
| (2, 64, 64, 128, 3, 1, 2)| 0.343 | 1.116 | 0.186 | 5.99x | 1.90x |
| (2, 64, 64, 64, 3, 1, 1)| 0.985 | 1.732 | 0.726 | 2.39x | 1.36x |



### channels-last-3d-backward

| shape | contiguous | master (ch-last) | PR (ch-last) | PR > master (ch-last)? | PR > contiguous? |
| --- | --- | --- | --- | --- | --- |
| (2, 1024, 8, 512, 3, 1, 1)| 0.528 | 0.552 | 0.397 | 1.39x | 1.33x |
| (2, 128, 32, 128, 3, 1, 1)| 0.748 | 0.934 | 0.692 | 1.35x | 1.09x |
| (2, 128, 32, 256, 2, 0, 2)| 0.285 | 0.362 | 0.211 | 1.72x | 1.34x |
| (2, 128, 32, 256, 3, 1, 2)| 0.371 | 0.439 | 0.284 | 1.54x | 1.28x |
| (2, 128, 64, 64, 3, 1, 1)| 3.502 | 5.278 | 2.869 | 1.84x | 1.22x |
| (2, 256, 16, 256, 3, 1, 1)| 0.363 | 0.414 | 0.320 | 1.30x | 1.14x |
| (2, 256, 16, 512, 2, 0, 2)| 0.199 | 0.221 | 0.175 | 1.26x | 1.12x |
| (2, 256, 16, 512, 3, 1, 2)| 0.222 | 0.252 | 0.166 | 1.51x | 1.33x |
| (2, 256, 32, 128, 3, 1, 1)| 1.344 | 1.607 | 1.204 | 1.33x | 1.11x |
| (2, 32, 128, 32, 3, 1, 1)| 8.894 | 15.435 | 6.966 | 2.22x | 1.28x |
| (2, 32, 128, 4, 1, 0, 1)| 2.922 | 3.464 | 1.790 | 1.94x | 1.63x |
| (2, 32, 128, 64, 2, 0, 2)| 3.523 | 4.768 | 2.412 | 1.98x | 1.46x |
| (2, 32, 128, 64, 3, 1, 2)| 5.627 | 6.862 | 4.517 | 1.52x | 1.24x |
| (2, 4, 128, 32, 3, 1, 1)| 8.261 | 14.540 | 6.866 | 2.12x | 1.20x |
| (2, 512, 16, 256, 3, 1, 1)| 0.611 | 0.686 | 0.552 | 1.24x | 1.12x |
| (2, 512, 4, 512, 3, 1, 1)| 0.211 | 0.232 | 0.150 | 1.55x | 1.39x |
| (2, 512, 8, 512, 2, 0, 2)| 0.232 | 0.252 | 0.234 | 1.08x | 1.01x |
| (2, 512, 8, 512, 3, 1, 1)| 0.298 | 0.327 | 0.229 | 1.43x | 1.29x |
| (2, 512, 8, 512, 3, 1, 2)| 0.209 | 0.219 | 0.164 | 1.34x | 1.24x |
| (2, 64, 128, 32, 3, 1, 1)| 12.800 | 20.330 | 10.099 | 2.01x | 1.27x |
| (2, 64, 64, 128, 2, 0, 2)| 0.877 | 1.231 | 0.649 | 1.90x | 1.35x |
| (2, 64, 64, 128, 3, 1, 2)| 1.148 | 1.511 | 0.923 | 1.64x | 1.25x |
| (2, 64, 64, 64, 3, 1, 1)| 2.073 | 3.059 | 1.666 | 1.84x | 1.26x |



